(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-75f4"],{"0DFs":function(e,t,n){"use strict";n.r(t);var i=n("Q5bf"),o=n("GLQk");for(var r in o)"default"!==r&&function(e){n.d(t,e,function(){return o[e]})}(r);n("fzx9");var s=n("KHd+"),a=Object(s.a)(o.default,i.a,i.b,!1,null,null,null);a.options.__file="index.vue",t.default=a.exports},"0Tir":function(e,t,n){"use strict";n.r(t);var i=n("VJl/"),o=n("SL+u");for(var r in o)"default"!==r&&function(e){n.d(t,e,function(){return o[e]})}(r);n("juo/");var s=n("KHd+"),a=Object(s.a)(o.default,i.a,i.b,!1,null,"43de2108",null);a.options.__file="edit-md.vue",t.default=a.exports},"8ylN":function(e,t,n){},AjqV:function(e,t,n){"use strict";n.r(t);var i=n("pQ9A"),o=n.n(i);for(var r in i)"default"!==r&&function(e){n.d(t,e,function(){return i[e]})}(r);t.default=o.a},DIbS:function(e,t,n){},FVH1:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s(n("14Xm")),o=s(n("4d7F")),r=s(n("D3Ub"));function s(e){return e&&e.__esModule?e:{default:e}}var a=function(){var e=(0,r.default)(i.default.mark(function e(t,n){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new o.default(function(e,i){try{if(document.getElementById(n)){if(window.DocsAPI)return e(null);var o=setInterval(function(){if(window.DocsAPI)return clearInterval(o),e(null)},500)}else{var r=document.createElement("script");r.setAttribute("type","text/javascript"),r.setAttribute("id",n),r.onload=e,r.onerror=i,r.src=t,r.async=!0,document.body.appendChild(r)}}catch(e){console.error(e)}}));case 1:case"end":return e.stop()}},e,void 0)}));return function(t,n){return e.apply(this,arguments)}}();t.default=a},GLQk:function(e,t,n){"use strict";n.r(t);var i=n("s4qX"),o=n.n(i);for(var r in i)"default"!==r&&function(e){n.d(t,e,function(){return i[e]})}(r);t.default=o.a},GoQ7:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getContent=function(e,t){var n=o.default.HOST+"/api/"+e.key+"/content/"+(void 0==e.id?"":e.id);return(0,i.default)({url:n,method:"get",params:t})},t.getTree=function(e,t){var n=o.default.HOST+"/api/"+e.key+"/tree";return(0,i.default)({url:n,method:"get",params:t})},t.Create=function(e,t){var n=o.default.HOST+"/api/"+e.key+"/create";return(0,i.default)({url:n,method:"post",data:t})},t.docIndex=function(e,t){var n=o.default.HOST+"/docs/"+e.key+"/info";return(0,i.default)({url:n,method:"get",data:t})},t.deleteDoc=function(e,t){var n=o.default.HOST+"/api/"+e.key+"/delete";return(0,i.default)({url:n,method:"post",data:t})};var i=r(n("t3Un")),o=r(n("bs5h"));function r(e){return e&&e.__esModule?e:{default:e}}},Q5bf:function(e,t,n){"use strict";var i=function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"view"},[t("div",{attrs:{id:this.id}})])},o=[];n.d(t,"a",function(){return i}),n.d(t,"b",function(){return o})},Rcnc:function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{style:{width:"100vw",height:e.headerHeight,display:"flex"}},[n("div",{staticStyle:{order:"0","font-size":"40px","font-weight":"bolder"}},[e._v(e._s(e.book.book_name))]),e._v(" "),n("div",{staticStyle:{order:"1"}},[n("el-button",{staticClass:"el-icon-edit",attrs:{disabled:!e.id,type:"danger"},on:{click:e.gotoEdit}},[e._v("编辑")])],1)]),e._v(" "),n("div",{staticStyle:{display:"flex"}},[n("div",{staticStyle:{order:"0",width:"300px"},style:{height:"calc(100vh - "+e.headerHeight+")"}},[n("el-card",{style:{height:"calc(100vh - "+e.headerHeight+")",overflowY:"scroll"}},[n("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[n("span",[e._v("目录")])]),e._v(" "),n("div",[n("el-tree",{ref:"treeSelect",attrs:{data:e.tree,props:{children:"children",label:"text"},"node-key":"id","highlight-current":"","default-expanded-keys":[10],"default-expand-all":"","curren-node-key":e.id,"expand-on-click-node":!1},on:{"node-click":e.clickNode},scopedSlots:e._u([{key:"default",fn:function(t){t.node;var i=t.data;return n("span",{staticClass:"custom-tree-node"},[[e._v("\n         "+e._s(i.text)+"\n      ")]],2)}}])})],1)])],1),e._v(" "),e.currNode&&e.currNode.is_open&&2!=e.currNode.is_open?n("div",{staticStyle:{order:"1",width:"calc(100vw - 300px)"},style:{height:"calc(100vh - "+e.headerHeight+")"}},[n("div",{staticStyle:{height:"calc(100vh - 60px)"}},[1==e.currNode.editor_type?n("mavon-editor",{style:{height:"calc(100vh - "+e.headerHeight+")"},attrs:{toolbarsFlag:!1,subfield:!1,defaultOpen:"preview",editable:!1,navigation:!0,boxShadow:!1},on:{change:e.handleChange},model:{value:e.content,callback:function(t){e.content=t},expression:"content"}}):e._e(),e._v(" "),2==e.currNode.editor_type?n("vab-only-office",{ref:"officePreview",attrs:{id:"office-preview",width:"100%",height:"100%"}}):e._e()],1)]):e._e(),e._v(" "),e.editDirVisible?n("edit-dir",{ref:"editDir",attrs:{submit:e.confirmDir}}):e._e(),e._v(" "),e.editMdVisible?n("edit-md",{ref:"editMd",attrs:{submit:e.confirmMd}}):e._e()],1)])},o=[];n.d(t,"a",function(){return i}),n.d(t,"b",function(){return o})},"SL+u":function(e,t,n){"use strict";n.r(t);var i=n("u8Nb"),o=n.n(i);for(var r in i)"default"!==r&&function(e){n.d(t,e,function(){return i[e]})}(r);t.default=o.a},"VJl/":function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{attrs:{title:e.key?"编辑":"添加文档",visible:e.visible,width:"30%",center:""},on:{"update:visible":function(t){e.visible=t}}},[n("el-form",{ref:"form",attrs:{model:e.form,"label-width":"80px"}},[n("el-form-item",{attrs:{label:"是否展开",prop:"isOpen"}},[n("el-radio-group",{model:{value:e.form.isOpen,callback:function(t){e.$set(e.form,"isOpen",t)},expression:"form.isOpen"}},[n("el-radio",{attrs:{label:1}},[e._v("展开")]),e._v(" "),n("el-radio",{attrs:{label:0}},[e._v("折叠")])],1)],1),e._v(" "),n("el-form-item",{attrs:{label:"名称",prop:"name"}},[n("el-input",{model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),n("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{label:"t",prop:"t"}})],1),e._v(" "),n("span",{attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.visible=!1}}},[e._v("取 消")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:e.confirm}},[e._v("确 定")])],1)],1)},o=[];n.d(t,"a",function(){return i}),n.d(t,"b",function(){return o})},c8we:function(e,t,n){"use strict";var i=n("nnAJ");n.n(i).a},"eWX/":function(e,t,n){"use strict";var i=n("8ylN");n.n(i).a},esWS:function(e,t,n){},fzx9:function(e,t,n){"use strict";var i=n("DIbS");n.n(i).a},"juo/":function(e,t,n){"use strict";var i=n("esWS");n.n(i).a},nWTU:function(e,t,n){"use strict";n.r(t);var i=n("xmZf"),o=n.n(i);for(var r in i)"default"!==r&&function(e){n.d(t,e,function(){return i[e]})}(r);t.default=o.a},njmX:function(e,t,n){"use strict";n.r(t);var i=n("qpqA"),o=n("nWTU");for(var r in o)"default"!==r&&function(e){n.d(t,e,function(){return o[e]})}(r);n("eWX/");var s=n("KHd+"),a=Object(s.a)(o.default,i.a,i.b,!1,null,"2565d138",null);a.options.__file="edit-dir.vue",t.default=a.exports},nnAJ:function(e,t,n){},nvaH:function(e,t,n){"use strict";n.r(t);var i=n("Rcnc"),o=n("AjqV");for(var r in o)"default"!==r&&function(e){n.d(t,e,function(){return o[e]})}(r);n("c8we");var s=n("KHd+"),a=Object(s.a)(o.default,i.a,i.b,!1,null,"2127022e",null);a.options.__file="view-doc.vue",t.default=a.exports},pQ9A:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=g(n("FyfS")),o=g(n("gDS+")),r=n("GoQ7"),s=n("xucW"),a=g(n("NsiU")),d=g(n("ynI1")),u=g(n("a/Yz")),c=g(n("EgDG")),l=g(n("49DM")),f=g(n("5J6R")),h=g(n("8HqY")),v=g(n("D9AB")),p=g(n("njmX")),y=g(n("0Tir")),m=g(n("0DFs"));function g(e){return e&&e.__esModule?e:{default:e}}var _=[(0,u.default)(),(0,c.default)(),(0,f.default)(),(0,l.default)(),(0,h.default)(),(0,v.default)()];t.default={name:"EditDoc",components:{Editor:d.default,Viewer:s.Viewer,"tinymce-editor":d.default,EditDir:p.default,EditMd:y.default,vabOnlyOffice:m.default},data:function(){return{key:this.$route.params.key,id:this.$route.params.id,mode:"view",tree:void 0,content:"",currNode:{},book:{book_id:void 0,book_name:void 0},plugins:_,zhHans:a.default,title:"",checkedKeys:[10],init:{language_url:"/lib/js/zh_CN.js",language:"zh_CN",height:430,plugins:"link lists image code table colorpicker textcolor wordcount contextmenu",toolbar:"bold italic underline strikethrough | fontsizeselect | forecolor backcolor | alignleft aligncenter alignright alignjustify|bullist numlist |outdent indent blockquote | undo redo | link unlink image code | removeformat",branding:!1,images_upload_handler:function(e,t,n){t("data:image/jpeg;base64,"+e.base64())}},editDirVisible:!1,editMdVisible:!1,menuVisible:!1,visible:!1,top:0,left:0,headerHeight:"60px",currRightNode:{id:void 0}}},mounted:function(){this.id&&(this.checkedKeys=[],this.checkedKeys.push(this.id)),this.docIndex(),this.reqContent()},watch:{visible:function(e){}},methods:{gotoEdit:function(){this.$router.push({name:"editDoc2"})},openMenu:function(e,t){this.currRightNode=void 0,console.log(e,t);var n=this.$el.getBoundingClientRect().left,i=this.$el.offsetWidth-105,o=e.clientX-n;this.left=o>i?i:o,this.top=e.clientY-60,this.top<0&&(this.top=0),this.currRightNode=t,this.visible=!0},editDir:function(){var e=this;this.visible=!1,this.editDirVisible=!0,this.$nextTick(function(){e.$refs.editDir.init()})},editMarkdown:function(){var e=this;this.visible=!1,this.editMdVisible=!0,this.$nextTick(function(){e.$refs.editMd.init()})},confirmDir:function(e){var t=this,n={};n.identify=this.key,n.doc_id=0,n.doc_identify=this.key+"-"+e.t,n.doc_name=e.name,n.parent_id=this.currRightNode&&this.currRightNode.id?this.currRightNode.id:0,n.is_open=2,n.content="",(0,r.Create)({key:this.key},n).then(function(e){console.log(e.data.data),0==e.data.errcode&&t.reqTree()})},confirmMd:function(e){var t=this,n={};n.identify=this.key,n.doc_id=0,n.doc_identify=this.key+"-"+e.t,n.doc_name=e.name,n.parent_id=this.currRightNode&&this.currRightNode.id?this.currRightNode.id:0,n.is_open=e.isOpen,n.content="",(0,r.Create)({key:this.key},n).then(function(e){console.log(e.data.data),0==e.data.errcode&&t.reqTree()})},saveContent:function(){var e=this.currNode;e.doc_identify=""+e.identify,e.identify=this.key,e.content="",e.content=""+this.content,console.log(e.content),(0,r.Create)({key:this.key},e).then(function(e){console.log(e.data.data)})},reqTree:function(){var e=this;(0,r.getTree)({key:this.key},{}).then(function(t){console.log(t.data),e.tree=e.listToTreeList(JSON.parse(t.data.data)),e.$nextTick(function(){e.$refs.treeSelect.setCurrentKey(e.id)})})},reqContent:function(){void 0!=this.id&&this.getContent({key:this.key,id:this.id},{mode:this.mode})},getContent:function(e,t){var n=this;(0,r.getContent)(e,t).then(function(e){n.content=e.data.data.content,n.currNode=e.data.data,2==n.currNode.editor_type&&n.$nextTick(function(){n.currNode.Config.config.token=n.currNode.Config.token;var e=(0,o.default)(n.currNode.Config.config);n.$refs.officePreview.init(e)})})},clickNode:function(e){this.visible=!1,this.title=e.text,this.id=e.id,this.$router.replace({name:"viewDoc2",params:{key:this.key,id:e.id}}),this.getContent({key:this.key,id:e.id},{mode:this.mode})},handleChange:function(e){this.content=e},listToTreeList:function(e){if(!e||!e.length)return[];var t={},n=!0,o=!1,r=void 0;try{for(var s,a=(0,i.default)(e);!(n=(s=a.next()).done);n=!0){var d=s.value;t[d.id]=d}}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}for(var u=0;u<e.length;u++)e[u].parent&&t[e[u].parent]&&(t[e[u].parent].children||(t[e[u].parent].children=[]),t[e[u].parent].children.push(e[u]),e.splice(u,1),u--);return e},docIndex:function(){var e=this;(0,r.docIndex)({key:this.key},{}).then(function(t){console.log(t.data.data);var n=t.data;0==n.errcode&&(e.book=n.data,e.reqTree())})}}}},qpqA:function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{attrs:{title:e.key?"编辑":"添加目录",visible:e.visible,width:"30%",center:""},on:{"update:visible":function(t){e.visible=t}}},[n("el-form",{ref:"form",attrs:{model:e.form,"label-width":"80px"}},[n("el-form-item",{attrs:{label:"目录名称",prop:"name"}},[n("el-input",{model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1)],1),e._v(" "),n("span",{attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.visible=!1}}},[e._v("取 消")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:e.confirm}},[e._v("确 定")])],1)],1)},o=[];n.d(t,"a",function(){return i}),n.d(t,"b",function(){return o})},s4qX:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(n("QbLZ")),o=r(n("FVH1"));function r(e){return e&&e.__esModule?e:{default:e}}t.default={name:"DocumentEditor",props:{id:{type:String,default:""},documentServerUrl:{type:String,default:""},document_fileType:{type:String,default:""},document_title:{type:String,default:""},documentType:{type:String,default:""},editorConfig_lang:{type:String,default:""},height:{type:String,default:""},type:{type:String,default:""},width:{type:String,default:""},events_onAppReady:{type:Function,default:function(){}},events_onDocumentStateChange:{type:Function,default:function(){}},events_onMetaChange:{type:Function,default:function(){}},events_onDocumentReady:{type:Function,default:function(){}},events_onInfo:{type:Function,default:function(){}},events_onWarning:{type:Function,default:function(){}},events_onError:{type:Function,default:function(){}},events_onRequestSharingSettings:{type:Function,default:function(){}},events_onRequestRename:{type:Function,default:function(){}},events_onMakeActionLink:{type:Function,default:function(){}},events_onRequestInsertImage:{type:Function,default:function(){}},events_onRequestSaveAs:{type:Function,default:function(){}},event_onDownloadAs:{type:Function,default:function(){}},events_onRequestMailMergeRecipients:{type:Function,default:function(){}},events_onRequestCompareFile:{type:Function,default:function(){}},events_onRequestEditRights:{type:Function,default:function(){}},events_onRequestHistory:{type:Function,default:function(){}},events_onRequestHistoryClose:{type:Function,default:function(){}},events_onRequestHistoryData:{type:Function,default:function(){}},events_onRequestRestore:{type:Function,default:function(){}}},data:function(){return{config:{}}},watch:{config:{handler:function(){this.onChangeProps()},deep:!0},document_fileType:function(){this.onChangeProps()},document_title:function(){this.onChangeProps()},documentType:function(){this.onChangeProps()},editorConfig_lang:function(){this.onChangeProps()},height:function(){this.onChangeProps()},type:function(){this.onChangeProps()},width:function(){this.onChangeProps()}},mounted:function(){},beforeDestroy:function(){var e=this.id||"";window&&window.DocEditor&&window.DocEditor.instances[e]&&(window.DocEditor.instances[e].destroyEditor(),window.DocEditor.instances[e]=void 0)},methods:{init:function(e){var t=this;e&&(this.config=JSON.parse(e));var n=this.config.docServiceApiUrl;console.log("docApiUrl",this.config.docServiceApiUrl),(0,o.default)(n,"onlyoffice-api-script").then(function(){return t.onLoad()}).catch(function(e){return console.error(e)})},onLoad:function(){try{var e=this.id||"";if(!window.DocsAPI)throw new Error("DocsAPI is not defined");if(window&&window.DocEditor&&window.DocEditor.instances[e])return void console.log("Skip loading. Instance already exists",e);window&&window.DocEditor&&window.DocEditor.instances||(window.DocEditor={instances:{}});var t=(0,i.default)({document:{fileType:this.document_fileType,title:this.document_title},documentType:this.documentType,editorConfig:{lang:this.editorConfig_lang},events:{onAppReady:this.onAppReady,onDocumentStateChange:this.events_onDocumentStateChange,onMetaChange:this.events_onMetaChange,onDocumentReady:this.events_onDocumentReady,onInfo:this.events_onInfo,onWarning:this.events_onWarning,onError:this.events_onError,onRequestSharingSettings:this.events_onRequestSharingSettings,onRequestRename:this.events_onRequestRename,onMakeActionLink:this.events_onMakeActionLink,onRequestInsertImage:this.events_onRequestInsertImage,onRequestSaveAs:this.events_onRequestSaveAs,onDownloadAs:this.event_onDownloadAs,onRequestMailMergeRecipients:this.events_onRequestMailMergeRecipients,onRequestCompareFile:this.events_onRequestCompareFile,onRequestEditRights:this.events_onRequestEditRights,onRequestHistory:this.events_onRequestHistory,onRequestHistoryClose:this.events_onRequestHistoryClose,onRequestHistoryData:this.events_onRequestHistoryData,onRequestRestore:this.events_onRequestRestore},height:this.height,type:this.type,width:this.width},this.config||{}),n=window.DocsAPI.DocEditor(e,t);window.DocEditor.instances[e]=n}catch(e){console.error(e),this.events_onError(e)}},onAppReady:function(){var e=this.id||"";this.events_onAppReady(window.DocEditor.instances[e])},onChangeProps:function(){var e=this.id||"";window&&window.DocEditor&&window.DocEditor.instances[e]&&(window.DocEditor.instances[e].destroyEditor(),window.DocEditor.instances[e]=void 0,console.log("Important props have been changed. Load new Editor."),this.onLoad())},downloadAs:function(e){var t=this.id||"";window&&window.DocEditor&&window.DocEditor.instances[t]&&(console.log(window.DocEditor.instances[t]),window.DocEditor.instances[t].downloadAs(e))}}}},u8Nb:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"edit-dir",props:{submit:{type:Function,default:function(){}}},data:function(){return{key:void 0,visible:!1,form:{key:void 0,name:"",t:(new Date).getTime(),isOpen:1}}},methods:{init:function(e){this.visible=!0},confirm:function(){this.submit(this.form),this.$refs.form.resetFields(),this.visible=!1}}}},xmZf:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"edit-dir",props:{submit:{type:Function,default:function(){}}},data:function(){return{key:void 0,visible:!1,form:{key:void 0,name:"",t:(new Date).getTime(),isOpen:!1}}},methods:{init:function(e){var t=this;this.visible=!0,this.$nextTick(function(){t.$refs.form.resetFields()})},confirm:function(){this.submit(this.form),this.$refs.form.resetFields(),this.visible=!1}}}}}]);